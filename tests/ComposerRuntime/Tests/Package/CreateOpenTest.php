<?php

namespace ComposerRuntime\Tests\Package;

class CreateOpenTest extends \ComposerRuntime\Tests\Base
{
    public function testCreate1()
    {
        $this->package->create($this->values);
        $expected = $this->getExpected(__FUNCTION__);
        $this->assertEquals($expected, $this->package->toJson());
    }

    public function testCreate2()
    {
        unset($this->values['description']);
        $this->package->create($this->values);
        $expected = $this->getExpected(__FUNCTION__);
        $this->assertEquals($expected, $this->package->toJson());
    }

    public function testCreate3()
    {
        $this->package->create(null);
        $this->assertEmpty($this->package->error);
    }

    /**
    * @expectedException        JohnStevenson\ComposerRuntime\PackageException
    * @expectedExceptionMessage Invalid email
    *
    */
    public function testCreateFail1()
    {
        $package = $this->getNewPackage(true);
        $this->values['email'] = 'somewhere.org';
        $package->create($this->values);
    }

    public function testCreateFail2()
    {
        $package = $this->getNewPackage();
        unset($this->values['name']);
        $result = $package->create($this->values);
        $this->assertFalse($result);
    }

    public function testOpen()
    {
        $filename = $this->getFilename('testCreate1');
        $this->package->open($filename);
        $expected = $this->getExpected('testCreate1');
        $this->assertEquals($expected, $this->package->toJson());
    }

    /**
    * @expectedException        JohnStevenson\ComposerRuntime\PackageException
    * @expectedExceptionMessage Invalid email
    *
    */
    public function testOpenFail()
    {
        $package = $this->getNewPackage(true);
        $package->open($this->getFilename(__FUNCTION__));
    }

    /**
    * @expectedException        JohnStevenson\ComposerRuntime\PackageException
    * @expectedExceptionMessage Unable to open file
    *
    */
    public function testOpenFailFile()
    {
        $package = $this->getNewPackage(true);
        $package->open($this->getFilename(__FUNCTION__));
    }

    public function testDummy()
    {
        $composer = new \JohnStevenson\ComposerRuntime\Process();
        $result = $composer->run('-v');
        $this->assertTrue($result);
    }
}

